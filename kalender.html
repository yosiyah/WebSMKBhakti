<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kalender Acara - SMK BHAKTI PACET</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header>
      <div class="container">
        <div class="logo">
          <img
            src="images/logo/logo-smk-bhakti-pacet.png"
            alt="Logo SMK BHAKTI PACET"
            width="50"
            height="50"
          />
          <h1>SMK BHAKTI PACET</h1>
        </div>
        <nav>
          <ul class="nav-menu">
            <li><a href="index.html">Beranda</a></li>
            <li><a href="tentang.html">Tentang</a></li>
            <li><a href="berita.html">Kegiatan</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle">Kurikulum</a>
              <ul class="dropdown-menu">
                <li><a href="kelas.html">Intrakurikuler</a></li>
                <li>
                  <a href="smk-bhakti-pacet/ekstrakurikuler.html"
                    >Ekstrakurikuler</a
                  >
                </li>
                <li>
                  <a href="smk-bhakti-pacet/kokurikuler.html">Kokurikuler</a>
                </li>
                <li>
                  <a href="kalender.html" class="active">Kalender Akademik</a>
                </li>
              </ul>
            </li>
            <li><a href="forum.html">Forum</a></li>
            <li><a href="galeri.html">Galeri</a></li>
            <li><a href="pendaftaran.html">Pendaftaran</a></li>
            <li><a href="kontak.html">Kontak</a></li>
            <li><a href="login.html" class="login-btn">Login/Daftar</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <main>
      <div class="container">
        <section class="calendar-section">
          <h2>Kalender Acara Sekolah</h2>
          <p>
            Lihat semua acara mendatang, liburan, dan tanggal penting di SMK
            BHAKTI PACET.
          </p>

          <div class="calendar-controls">
            <button id="prev-month">< Bulan Sebelumnya</button>
            <h3 id="current-month">September 2024</h3>
            <button id="next-month">Bulan Berikutnya ></button>
          </div>

          <div class="calendar-grid">
            <div class="day">Minggu</div>
            <div class="day">Senin</div>
            <div class="day">Selasa</div>
            <div class="day">Rabu</div>
            <div class="day">Kamis</div>
            <div class="day">Jumat</div>
            <div class="day">Sabtu</div>
            <!-- Calendar days will be populated by JavaScript -->
          </div>

          <div id="event-details" class="event-details" style="display: none">
            <h3 id="event-title">Detail Acara</h3>
            <div id="event-content">
              <p id="event-description"></p>
              <p><strong>Tanggal:</strong> <span id="event-date"></span></p>
              <p><strong>Waktu:</strong> <span id="event-time"></span></p>
              <p>
                <strong>Lokasi:</strong>
                <span id="event-location">Sekolah SMK BHAKTI PACET</span>
              </p>
            </div>
          </div>

          <h3>Acara Mendatang</h3>
          <div id="upcoming-events" class="events-list">
            <div class="loading-state">
              <p>Memuat acara...</p>
            </div>
          </div>
        </section>
      </div>
    </main>

    <footer>
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h4>Info Kontak</h4>
            <p>Alamat: Jl. Contoh No. 123, Kota</p>
            <p>Telepon: (021) 123-4567</p>
            <p>Email: info@smkbhaktipacet.sch.id</p>
          </div>
          <div class="footer-section">
            <h4>Tautan Sosial</h4>
            <a href="#">Facebook</a> | <a href="#">Instagram</a> |
            <a href="#">Twitter</a>
          </div>
        </div>
        <p>&copy; 2023 SMK BHAKTI PACET. Semua hak dilindungi.</p>
      </div>
    </footer>

    <script src="script.js"></script>
    <script>
      // Calendar state
      let currentDate = new Date();
      let eventsData = [];

      // Load events and initialize calendar
      async function loadEvents() {
        try {
          const response = await fetch("api/kalender.php");
          eventsData = await response.json();
          renderCalendar();
          loadUpcomingEvents();
        } catch (error) {
          console.error("Error loading events:", error);
        }
      }

      // Render calendar for current month
      function renderCalendar() {
        const calendarGrid = document.querySelector(".calendar-grid");
        const currentMonthElement = document.getElementById("current-month");

        // Clear existing calendar days (keep headers)
        const dayHeaders = calendarGrid.querySelectorAll(".day");
        calendarGrid.innerHTML = "";
        dayHeaders.forEach((header) => calendarGrid.appendChild(header));

        // Update month display
        const monthNames = [
          "Januari",
          "Februari",
          "Maret",
          "April",
          "Mei",
          "Juni",
          "Juli",
          "Agustus",
          "September",
          "Oktober",
          "November",
          "Desember",
        ];
        currentMonthElement.textContent = `${
          monthNames[currentDate.getMonth()]
        } ${currentDate.getFullYear()}`;

        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();

        // Get first day of month and last day of month
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startDate = new Date(firstDay);
        startDate.setDate(startDate.getDate() - firstDay.getDay());

        // Generate calendar days
        let currentDatePointer = new Date(startDate);

        for (let i = 0; i < 42; i++) {
          // 6 weeks * 7 days
          const dayElement = document.createElement("div");
          const dayNumber = currentDatePointer.getDate();

          if (currentDatePointer.getMonth() === month) {
            dayElement.className = "calendar-day";
            dayElement.textContent = dayNumber;

            // Check if this date has events
            const dateString = currentDatePointer.toISOString().split("T")[0];
            const dayEvents = eventsData.filter(
              (event) => event.tanggal_mulai === dateString
            );

            if (dayEvents.length > 0) {
              dayElement.classList.add("has-event");
              dayElement.title = `${dayEvents.length} acara`;
            }

            // Highlight today
            const today = new Date();
            if (currentDatePointer.toDateString() === today.toDateString()) {
              dayElement.classList.add("today");
            }

            // Add click handler
            dayElement.addEventListener("click", () =>
              showEventsForDate(dateString, dayEvents)
            );
          } else {
            dayElement.className = "calendar-day prev-month";
            dayElement.textContent = dayNumber;
          }

          calendarGrid.appendChild(dayElement);
          currentDatePointer.setDate(currentDatePointer.getDate() + 1);
        }
      }

      // Show events for selected date
      function showEventsForDate(dateString, events) {
        const eventDetails = document.getElementById("event-details");
        const eventTitle = document.getElementById("event-title");
        const eventContent = document.getElementById("event-content");

        if (events.length === 0) {
          eventTitle.textContent = "Tidak ada acara";
          eventContent.innerHTML = `<p>Tidak ada acara pada tanggal ini.</p>`;
        } else {
          const date = new Date(dateString);
          const dateStr = date.toLocaleDateString("id-ID", {
            weekday: "long",
            day: "numeric",
            month: "long",
            year: "numeric",
          });

          eventTitle.textContent = `Acara pada ${dateStr}`;

          let eventsHtml = "";
          events.forEach((event) => {
            const timeStr = event.waktu_mulai
              ? `${event.waktu_mulai}${
                  event.waktu_selesai ? " - " + event.waktu_selesai : ""
                }`
              : "Seharian";

            eventsHtml += `
              <div class="event-detail-item">
                <h4>${event.judul}</h4>
                <p><strong>Waktu:</strong> ${timeStr}</p>
                ${
                  event.lokasi
                    ? `<p><strong>Lokasi:</strong> ${event.lokasi}</p>`
                    : ""
                }
                ${event.deskripsi ? `<p>${event.deskripsi}</p>` : ""}
                <p><strong>Kategori:</strong> ${event.kategori}</p>
              </div>
              <hr>
            `;
          });

          eventContent.innerHTML = eventsHtml;
        }

        eventDetails.style.display = "block";
        eventDetails.scrollIntoView({ behavior: "smooth" });
      }

      // Load upcoming events
      function loadUpcomingEvents() {
        const eventsList = document.getElementById("upcoming-events");
        eventsList.innerHTML = "";

        // Filter upcoming events
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const upcomingEvents = eventsData
          .filter((event) => new Date(event.tanggal_mulai) >= today)
          .sort((a, b) => new Date(a.tanggal_mulai) - new Date(b.tanggal_mulai))
          .slice(0, 10);

        if (upcomingEvents.length === 0) {
          eventsList.innerHTML =
            '<div class="empty-state"><h4>Tidak ada acara mendatang</h4><p>Belum ada acara yang dijadwalkan.</p></div>';
          return;
        }

        upcomingEvents.forEach((event) => {
          const eventItem = document.createElement("div");
          eventItem.className = "event-item";

          const eventDate = new Date(event.tanggal_mulai);
          const dateStr = eventDate.toLocaleDateString("id-ID", {
            day: "numeric",
            month: "short",
            year: "numeric",
          });

          const timeStr = event.waktu_mulai
            ? `${event.waktu_mulai}${
                event.waktu_selesai ? " - " + event.waktu_selesai : ""
              }`
            : "Seharian";

          eventItem.innerHTML = `
            <div class="event-date">${dateStr}</div>
            <div class="event-details">
              <h4>${event.judul}</h4>
              <p>${event.deskripsi || "Deskripsi acara"}</p>
              <small class="event-meta">
                <span class="event-time">${timeStr}</span>
                ${
                  event.lokasi
                    ? `<span class="event-location"> • ${event.lokasi}</span>`
                    : ""
                }
                <span class="event-category"> • ${event.kategori}</span>
              </small>
            </div>
          `;

          eventsList.appendChild(eventItem);
        });
      }

      // Month navigation
      document.getElementById("prev-month").addEventListener("click", () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
      });

      document.getElementById("next-month").addEventListener("click", () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
      });

      // Load events when page loads
      document.addEventListener("DOMContentLoaded", loadEvents);
    </script>
  </body>
</html>
